function getFormattedDate(t=new Date,e=!1){let n=t.toString().split(" ");const a=n[0],i=n[1],l=n[2],o=n[3].substring(2),d=e?`${a}, ${i} ${l}`:`${l}-${i}-${o}`;let s=new Date(`${i} ${l}, ${n[3]}`);return s.setHours(0,0,0,0),{label:d,value:s}}function getFormattedTime(t=""){const e=new Date(t);let n=e.getHours(),a=e.getMinutes(),i="am";return n>12&&(n-=12,i="pm"),a<10&&(a="0"+a),`${n}:${a} ${i}`}function formatCurrency(t="0",e="JMD"){if(null==t)return"";t=`${t}`;const n=t.includes(".");let a,l;if(n){const e=t.indexOf(".");a=t.substring(0,e),l=t.substring(e+1),l+=l.length<2?"0":"",l=l.length>2?l.substring(0,2):l}else a=t,l="00";let o="",d=0;for(i=a.length-1;i>=0;i--)d++,4===d?(o=`${a[i]},`+o,d=1):o=`${a[i]}`+o;return`$ ${o}.${l} ${e}`}const SERVER="https://vc.pas-md.com/apk/pasmd",postData=async(t="",e={})=>{try{const n=await fetch(`${SERVER}/${t}`,{method:"POST",headers:{"Content-Type":"application/json",authtoken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJUF9TRVNTSU9OX0lEIjoxMDgzMDEsIk9SR19JRCI6MiwiTE9DX0lEIjoxLCJpYXQiOjE1OTcyNDAzOTR9.QT9RZ4BCqY2eFYuFd7liJIG-C4x1n2fvRcUxW5fq8tU"},body:JSON.stringify(e)});return n.json()}catch(t){throw console.error(`Error getting doctors: ${t}`),new Error(t)}};$(function(){function t(){y=!y,y?$("#modal").show():$("#modal").hide()}function e(t=""){$("#f-modal-error").show(),$("#f-modal-message").html(t),$("#custom-modals").show()}function n(){$("#f-modal-success").hide(),$("#f-modal-warning").hide(),$("#f-modal-error").hide(),$("#custom-modals").hide()}function a(t=new Date){var e=("0"+t.getDate()).slice(-2),n=("0"+(t.getMonth()+1)).slice(-2);return t.getFullYear()+"-"+n+"-"+e}function l(){var t=a();$("#date-selector").val(t),$("#date-selector").change(T)}function o(t,e,n,a){let i=C.filter(e=>e.DOC_ID==t);if(i.length>0){$("#apmt-doctor-id").val(i[0].DOC_ID),$("#apmt-doctor-name").val(i[0].DOCTOR_NAME),$("#apmt-doctor-cred").val(i[0].DEGREES_FMT),$("#apmt-doctor-spec").val(i[0].SPECILIZATION),$("#apmt-cost").val(i[0].CONS_FEE),$("#apmt-id").val(e);let t=new Date(n);$("#apmt-value-date").val(getFormattedDate(t,!0).label),$("#apmt-value-time").val(getFormattedTime(a))}}function d(){let t=document.getElementsByClassName("slot");for(i=0;i<t.length;i++)t[i].addEventListener("click",()=>{const t=$(this).val(),e=event.srcElement.getAttribute("ref"),n=event.srcElement.getAttribute("date"),a=event.srcElement.getAttribute("time");console.warn(`You clicked button ${e}|${t}|${n}|${a}`),o(e,t,n,a)})}function s(n="",a="",i=""){$(`#${n}`).change(()=>{t();let l=new Date(`${$(`#${n}`).val()}T00:00:00`);$(`#${a}`).empty();let o=$('<option value="" hidden disabled selected> - Select a Time - </option>');$(`#${a}`).append(o),postData("getSlots",{docId:`${i}`,aptDate:`${getFormattedDate(l,!1).label}`}).then(e=>{if(e.forEach(t=>{let e=$(`<option value="${i}|${t.SLOTS_ID}|${t.APMNT_DT}|${t.DISPLAY_TIME}" >${getFormattedTime(t.DISPLAY_TIME)}</option>`);$(`#${a}`).append(e)}),0===e.length){let t=$('<option value="" disabled>No time available</option>');$(`#${a}`).append(t)}t()}).catch(n=>{t(),e("Something went wrong when trying to update your request"),console.error(`[MOBILE-SELECTOR] Unable to complete API Request...\n${n}`)})})}function c(){let t=document.getElementsByClassName("mobile-apmt-picker");for(let e of t)e.addEventListener("change",()=>{const t=$(this).val().split("|")[0],e=$(this).val().split("|")[1],n=$(this).val().split("|")[2],a=$(this).val().split("|")[3];o(t,e,n,a)})}function r(){return'<div id="hidden" class="section">\n            <div class="section-col">\n                <div>\n                    <label for="apmt-doctor-name">Doctor</label>\n                    <input id="apmt-doctor-name" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-doctor-cred">Credentials</label>\n                    <input id="apmt-doctor-cred" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-doctor-spec">Specialty</label>\n                    <input id="apmt-doctor-spec" class="apmt-field" disabled/>\n                </div>\n            </div>\n            <div class="section-col">\n                <div>\n                    <label for="apmt-id">Apmt. ID</label>\n                    <input id="apmt-id" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-doctor-id">Doctor ID</label>\n                    <input id="apmt-doctor-id" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-cost">Cost</label>\n                    <input id="apmt-cost" class="apmt-field" disabled/>\n                </div>\n            </div>\n            <div class="section-col">\n                <div>\n                    <label for="apmt-value-date">Date</label>\n                    <input id="apmt-value-date" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-value-time">Time</label>\n                    <input id="apmt-value-time" class="apmt-field" disabled/>\n                </div>\n            </div>\n        </div>'}function m(){for(A=[],i=0;i<w;i++){let t=new Date(`${$("#date-selector").val()}T00:00:00`);t.setHours(0,0,0,0),t.setDate(t.getDate()+i),A.push(getFormattedDate(t,!0))}A=[...new Set(A)]}function v(){return'<div id="modal">\n            <div id="modal-loading" class="modal-body">\n                <div class="modal-title">LOADING</div>\n                <div class="modal-content">\n                    <div class="lds-ring">\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                    </div>\n                </div>\n            </div>\n        </div>'}function p(){return'<div class="f-modal-alert">\n            <div id="f-modal-error" class="f-modal-icon f-modal-error animate" style="display:none">\n                <span class="f-modal-x-mark">\n                    <span class="f-modal-line f-modal-left animateXLeft"></span>\n                    <span class="f-modal-line f-modal-right animateXRight"></span>\n                </span>\n                <div class="f-modal-placeholder"></div>\n                <div class="f-modal-fix"></div>\n            </div>\n            <div id="f-modal-warning" class="f-modal-icon f-modal-warning scaleWarning" style="display:none">\n                <span class="f-modal-body pulseWarningIns"></span>\n                <span class="f-modal-dot pulseWarningIns"></span>\n            </div>\n            <div id="f-modal-success" class="f-modal-icon f-modal-success animate" style="display:none">\n                <span class="f-modal-line f-modal-tip animateSuccessTip"></span>\n                <span class="f-modal-line f-modal-long animateSuccessLong"></span>\n                <div class="f-modal-placeholder"></div>\n                <div class="f-modal-fix"></div>\n            </div>\n            <div id="f-modal-message"></div>\n            <div>\n                <button id="f-modal-close" class="f-modal-button">Close</div>\n            </div>\n        </div>'}function u(){return'<div>\n            <label for="date-selector">Start Date</label>\n            <input id="date-selector" type="date" class="apmt-field" />\n        </div>'}function f(t="Dr. John Doe",e="BSc., MBBS",n="General Medicine",a=0,i=0,l=[],o=[],d=!1){let s=h(t,e,n,a,i),c=D(l,o,d);return`<div class="card">\n            ${s}\n            ${c}\n        </div>`}function g(t=0){return`<div class="selection-section-sml">\n            <div class="col">\n                <label for="apmt-date-selector-${t}">Appointment Date</label>\n                <input id="apmt-date-selector-${t}" type="date" class="apmt-field"/>\n            </div>\n            <div class="col">\n                <label for="apmt-time-selector-${t}">Appointment Time</label>\n                <select id="apmt-time-selector-${t}" class="apmt-field mobile-apmt-picker">\n                    <option value ="" hidden disabled selected> - Select a Time - </option>\n                </select>\n            </div>\n            <div>\n                <button id="apmt-select-submit-${t}" class="bttn bttn-sml">Next</button>\n            </div>\n        </div>`}function h(t="Dr. John Doe",e="BSc., MBBS",n="General Medicine",a=0,i=0){return`<div class="card-left">\n            <div class="details-section">\n                <div id="doctor-${i}-name" class="doctor-name">${t}</div>\n                <div id="doctor-${i}-cred" class="doctor-info">${e}</div>\n                <div id="doctor-${i}-spec" class="doctor-details">${n}</div>\n                <div id="doctor-${i}-cost" class="doctor-details">${formatCurrency(a)}</div>\n                </br>\n                <div class="select-indicator">Select an available time â†’</div>\n            </div>\n            ${g(i)}\n        </div>`}function D(t=[],e=[],n=!1){let a=`<div class="date-tabs">\n            ${t.map(t=>`<div class="date-tab">${t.label}</div>`).join("")}\n        </div>`,i=`<div class="schedule-overflow">\n            ${t.map(t=>{let n=e.filter(e=>e.APMNT_DT.substring(0,10)===t.value.toISOString().substring(0,10));return 0===n.length?'<div class="col"> <button class="slot">None</button> </div>':`<div class="col">\n                    ${n.map(t=>`<button class="slot" ref="${t.DOC_ID}" value="${t.SLOTS_ID}" date="${t.APMNT_DT}" time="${t.DISPLAY_TIME}">${getFormattedTime(t.DISPLAY_TIME)}</button>`).join("")}\n                </div>`}).join("")}\n        </div>`;return`<div class="card-right"> ${n?a:""} ${i} </div>`}function b(){let e="",n=0,a=!0;for(const t in O)if(O.hasOwnProperty(t)){let i=C.find(function(e){return e.DOC_ID==t});e+=f(i.DOCTOR_NAME,i.DEGREES_FMT,i.SPECILIZATION,i.CONS_FEE,n,A,O[t],a),a=!1,n++}$("#main").html(e),n=0;for(const t in O)s(`apmt-date-selector-${n}`,`apmt-time-selector-${n}`,t),n++;d(),c(),t()}function E(){for(const t in O){let e=[];O[t].forEach(t=>e=e.concat(t)),O[t]=e}b()}function I(){let t=0;C.forEach(n=>{let a=A.map(t=>postData("getSlots",{docId:`${n.DOC_ID}`,aptDate:`${getFormattedDate(t.value,!1).label}`}));Promise.all(a).then(e=>{O[`${n.DOC_ID}`]=e,t++,t===C.length&&E()}).catch(t=>{e("Something went wrong when updating the schedule. Please try again later."),console.error(`An error with the requests: ${t}`)})})}function S(){C.push({DOC_ID:223,DOCTOR_NAME:"John A Doe",DEGREES_FMT:"MDCM, FACS, FAANS (Physcian)",SPECILIZATION:"General Practicioner",EXPERIENCE:null,PRACTICE_NAME:"Pure Jamaica Medical Centre",SPECIALIZATION_ID:"00,00",SPECIALITY_ID:0,LOCATION_ADDR:"1 Stanton Terrace,  The Stantons , Kingston 6 , New Kingston",REG_FEE:50,CONS_FEE:5e3})}function T(){t();new Date(`${$("#date-selector").val()}T00:00:00`);m(),null==C||0==C.length?postData("getAllDoctors").then(t=>{C=t,S(),scheduleCounter=C.length*w,progressCounter=0,I()}).catch(t=>{e("Something went wrong during setup. Please try again later."),console.error(`Something went wrong with your request. ${t}`)}):(O={},progressCounter=0,I())}let C=[],O={},w=6,A=[],y=!1;$("#control-panel").html(v()+r()+u()),$("#custom-modals").html(p()),$("#f-modal-close").click(()=>n()),l(),T()});