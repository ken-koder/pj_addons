function getFormattedDate(t=new Date,e=!1){let n=t.toString().split(" ");const a=n[0],o=n[1],i=n[2],l=n[3].substring(2),s=e?`${a}, ${o} ${i}`:`${i}-${o}-${l}`;let d=new Date(`${o} ${i}, ${n[3]}`);return d.setHours(0,0,0,0),{label:s,value:d}}function getFormattedTime(t=""){const e=new Date(t);let n=e.getHours(),a=e.getMinutes(),o="am";return n>12&&(n-=12,o="pm"),a<10&&(a="0"+a),`${n}:${a} ${o}`}const SERVER="https://vc.pas-md.com/apk/pasmd",postData=async(t="",e={})=>{try{const n=await fetch(`${SERVER}/${t}`,{method:"POST",headers:{"Content-Type":"application/json",authtoken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJUF9TRVNTSU9OX0lEIjoxMDgzMDEsIk9SR19JRCI6MiwiTE9DX0lEIjoxLCJpYXQiOjE1OTcyNDAzOTR9.QT9RZ4BCqY2eFYuFd7liJIG-C4x1n2fvRcUxW5fq8tU"},body:JSON.stringify(e)});return n.json()}catch(t){throw console.error(`Error getting doctors: ${t}`),new Error(t)}};$(function(){function t(){T=!T,T?$("#modal").show():$("#modal").hide()}function e(t=new Date){var e=("0"+t.getDate()).slice(-2),n=("0"+(t.getMonth()+1)).slice(-2);return t.getFullYear()+"-"+n+"-"+e}function n(){var t=e();$("#date-selector").val(t),$("#date-selector").change(h)}function a(e="",n="",a=""){$(`#${e}`).change(()=>{t();let o=new Date(`${$(`#${e}`).val()}T00:00:00`);$(`#${n}`).empty();let i=$('<option value="" hidden disabled selected> - Select a Time - </option>');$(`#${n}`).append(i),postData("getSlots",{docId:`${a}`,aptDate:`${getFormattedDate(o,!1).label}`}).then(e=>{if(e.forEach(t=>{let e=$(`<option value="${t.SLOTS_ID}" >${getFormattedTime(t.DISPLAY_TIME)}</option>`);$(`#${n}`).append(e)}),0===e.length){let t=$('<option value="" disabled>No time available</option>');$(`#${n}`).append(t)}t()}).catch(e=>{t(),console.error(`[MOBILE-SELECTOR] Unable to complete API Request...\n${e}`)})})}function o(){for(I=[],i=0;i<g;i++){let t=new Date(`${$("#date-selector").val()}T00:00:00`);t.setHours(0,0,0,0),t.setDate(t.getDate()+i),I.push(getFormattedDate(t,!0))}I=[...new Set(I)]}function l(){return'<div id="modal">\n            <div id="modal-loading" class="modal-body">\n                <div class="modal-title">LOADING</div>\n                <div class="modal-content">\n                    <div class="lds-ring">\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                    </div>\n                </div>\n            </div>\n        </div>'}function s(){return'<div>\n            <label for="date-selector">Start Date</label>\n            <input id="date-selector" type="date" class="apmt-field" />\n        </div>'}function d(t="Dr. John Doe",e="BSc., MBBS",n=0,a=[],o=[],i=!1){let l=r(t,e,n),s=u(a,o,i);return`<div class="card">\n            ${l}\n            ${s}\n        </div>`}function c(t=0){return`<div class="selection-section-sml">\n            <div class="col">\n                <label for="apmt-date-selector-${t}">Appointment Date</label>\n                <input id="apmt-date-selector-${t}" type="date" class="apmt-field"/>\n            </div>\n            <div class="col">\n                <label for="apmt-time-selector-${t}">Appointment Time</label>\n                <select id="apmt-time-selector-${t}" class="apmt-field">\n                    <option value ="" hidden disabled selected> - Select a Time - </option>\n                </select>\n            </div>\n            <div>\n                <button id="apmt-select-submit-${t}" class="bttn bttn-sml">Next</button>\n            </div>\n        </div>`}function r(t="Dr. John Doe",e="BSc., MBBS",n=0){return`<div class="card-left">\n            <div class="details-section">\n                <div class="doctor-title">${t}</div>\n                <div class="doctor-info">${e}</div>\n                <div class="doctor-title">Select an available time â†’</div>\n            </div>\n            ${c(n)}\n        </div>`}function u(t=[],e=[],n=!1){let a=`<div class="date-tabs">\n            ${t.map(t=>`<div class="date-tab">${t.label}</div>`).join("")}\n        </div>`,o=`<div class="schedule-overflow">\n            ${t.map(t=>{let n=e.filter(e=>e.APMNT_DT.substring(0,10)===t.value.toISOString().substring(0,10));return 0===n.length?'<div class="col"> <button class="slot">None</button> </div>':`<div class="col">\n                    ${n.map(t=>`<button class="slot" value="${t.APMNT_DT}">${getFormattedTime(t.DISPLAY_TIME)}</button>`).join("")}\n                </div>`}).join("")}\n        </div>`;return`<div class="card-right"> ${n?a:""} ${o} </div>`}function v(){let e="",n=0,o=!0;for(const t in E)if(E.hasOwnProperty(t)){let a=f.find(function(e){return e.DOC_ID==t});e+=d(a.DOCTOR_NAME,a.DEGREES_FMT,n,I,E[t],o),o=!1,n++}$("#main").html(e),n=0;for(const t in E)a(`apmt-date-selector-${n}`,`apmt-time-selector-${n}`,t),n++;t()}function p(){for(const t in E){let e=[];E[t].forEach(t=>e=e.concat(t)),E[t]=e}v()}function m(){let t=0;f.forEach(e=>{let n=I.map(t=>postData("getSlots",{docId:`${e.DOC_ID}`,aptDate:`${getFormattedDate(t.value,!1).label}`}));Promise.all(n).then(n=>{E[`${e.DOC_ID}`]=n,t++,t===f.length&&p()}).catch(t=>console.error(`An error with the requests: ${t}`))})}function D(){f.push({DOC_ID:223,DOCTOR_NAME:"John A Doe",DEGREES_FMT:"MDCM, FACS, FAANS (Physcian)",SPECILIZATION:"General Practicioner",EXPERIENCE:null,PRACTICE_NAME:"Pure Jamaica Medical Centre",SPECIALIZATION_ID:"00,00",SPECIALITY_ID:0,LOCATION_ADDR:"1 Stanton Terrace,  The Stantons , Kingston 6 , New Kingston",REG_FEE:50,CONS_FEE:5e3})}function h(){t();new Date(`${$("#date-selector").val()}T00:00:00`);o(),null==f||0==f.length?postData("getAllDoctors").then(t=>{f=t,D(),scheduleCounter=f.length*g,progressCounter=0,m()}):(E={},progressCounter=0,m())}let f=[],E={},g=6,I=[],T=!1;$("#header").html(),$("#control-panel").html(l()+s()),n(),h()});