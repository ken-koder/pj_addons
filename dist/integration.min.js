function getFormattedDate(e=new Date,t=!1){let n=e.toString().split(" ");const a=n[0],l=n[1],i=n[2],o=n[3].substring(2),s=t?`${a}, ${l} ${i}`:`${i}-${l}-${o}`;let d=new Date(`${l} ${i}, ${n[3]}`);return d.setHours(0,0,0,0),{label:s,value:d}}function getFormattedTime(e=""){const t=new Date(e);let n=t.getHours(),a=t.getMinutes(),l="am";return n>12&&(n-=12,l="pm"),a<10&&(a="0"+a),`${n}:${a} ${l}`}function formatCurrency(e="0",t="JMD"){if(null==e)return"";e=`${e}`;const n=e.includes(".");let a,l;if(n){const t=e.indexOf(".");a=e.substring(0,t),l=e.substring(t+1),l+=l.length<2?"0":"",l=l.length>2?l.substring(0,2):l}else a=e,l="00";let o="",s=0;for(i=a.length-1;i>=0;i--)s++,4===s?(o=`${a[i]},`+o,s=1):o=`${a[i]}`+o;return`$ ${o}.${l} ${t}`}const SERVER="https://vc.pas-md.com/apk/pasmd",postData=async(e="",t={})=>{try{const n=await fetch(`${SERVER}/${e}`,{method:"POST",headers:{"Content-Type":"application/json",authtoken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJJUF9TRVNTSU9OX0lEIjoxMDgzMDEsIk9SR19JRCI6MiwiTE9DX0lEIjoxLCJpYXQiOjE1OTcyNDAzOTR9.QT9RZ4BCqY2eFYuFd7liJIG-C4x1n2fvRcUxW5fq8tU"},body:JSON.stringify(t)});return n.json()}catch(e){throw console.error(`Error getting doctors: ${e}`),new Error(e)}};$(function(){function e(){N=!N,N?$("#modal").show():$("#modal").hide()}function t(e=""){$("#f-modal-error").show(),$("#f-modal-message").html(e),$("#custom-modals").show()}function n(){$("#f-modal-success").hide(),$("#f-modal-warning").hide(),$("#f-modal-error").hide(),$("#custom-modals").hide()}function a(e=new Date){var t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2);return e.getFullYear()+"-"+n+"-"+t}function l(){var e=a();$("#date-selector").val(e),$("#date-selector").change(C)}function o(e,t,n,a){let l=O.filter(t=>t.DOC_ID==e);if(l.length>0){$("#apmt-doctor-id").val(l[0].DOC_ID),$("#apmt-doctor-name").val(l[0].DOCTOR_NAME),$("#apmt-doctor-cred").val(l[0].DEGREES_FMT),$("#apmt-doctor-spec").val(l[0].SPECILIZATION),$("#apmt-cost").val(l[0].CONS_FEE),$("#apmt-id").val(t);let e=new Date(n);$("#apmt-value-date").val(getFormattedDate(e,!0).label),$("#apmt-value-time").val(getFormattedTime(a));const i=$("#label-selected-doctor-name").length>0,o=$("#label-selected-doctor-details").length>0,s=$("#label-selected-apmt-date").length>0,d=$("#label-selected-apmt-time").length>0,c=$("#label-selected-apmt-cost").length>0,r=$("#label-selected-apmt-id").length>0;console.info(`Name exist: ${i} | Details exist: ${o} | Date exists: ${s} | Time exists: ${d} | Cost exists: ${c} | ID exists ${r}`),$("#label-selected-doctor-name").html(l[0].DOCTOR_NAME),$("#label-selected-doctor-details").html(`${l[0].DEGREES_FMT}</br>${l[0].SPECILIZATION}`),$("#label-selected-apmt-date").html(getFormattedDate(e,!0).label),$("#label-selected-apmt-time").html(getFormattedTime(a)),$("#label-selected-apmt-cost").html(l[0].CONS_FEE),$("#label-selected-apmt-id").html(t)}}function s(){let e=document.getElementsByClassName("slot");for(i=0;i<e.length;i++)e[i].addEventListener("click",()=>{const e=event.srcElement.value,t=event.srcElement.getAttribute("ref"),n=event.srcElement.getAttribute("date"),a=event.srcElement.getAttribute("time");console.warn(`You clicked button ${t}|${e}|${n}|${a}`),o(t,e,n,a)})}function d(n="",a="",l=""){$(`#${n}`).change(()=>{e();const i=`#${n}`;let o=new Date(`${$(i).val()}T00:00:00`);$(`#${a}`).empty();let s=$('<option value="" hidden disabled selected> - Select a Time - </option>');$(`#${a}`).append(s),postData("getSlots",{docId:`${l}`,aptDate:`${getFormattedDate(o,!1).label}`}).then(t=>{if(t.forEach(e=>{let t=$(`<option value="${l}|${e.SLOTS_ID}|${e.APMNT_DT}|${e.DISPLAY_TIME}" >${getFormattedTime(e.DISPLAY_TIME)}</option>`);$(`#${a}`).append(t)}),0===t.length){let e=$('<option value="" disabled>No time available</option>');$(`#${a}`).append(e)}e()}).catch(n=>{e(),t("Something went wrong when trying to update your request"),console.error(`[MOBILE-SELECTOR] Unable to complete API Request...\n${n}`)})})}function c(){let e=document.getElementsByClassName("mobile-apmt-picker");for(let t of e)t.addEventListener("change",()=>{const e=event.srcElement.value.split("|")[0],t=event.srcElement.value.split("|")[1],n=event.srcElement.value.split("|")[2],a=event.srcElement.value.split("|")[3];o(e,t,n,a)})}function r(){return'<div id="hidden" class="section">\n            <div class="section-col">\n                <div>\n                    <label for="apmt-doctor-name">Doctor</label>\n                    <input id="apmt-doctor-name" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-doctor-cred">Credentials</label>\n                    <input id="apmt-doctor-cred" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-doctor-spec">Specialty</label>\n                    <input id="apmt-doctor-spec" class="apmt-field" disabled/>\n                </div>\n            </div>\n            <div class="section-col">\n                <div>\n                    <label for="apmt-id">Apmt. ID</label>\n                    <input id="apmt-id" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-doctor-id">Doctor ID</label>\n                    <input id="apmt-doctor-id" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-cost">Cost</label>\n                    <input id="apmt-cost" class="apmt-field" disabled/>\n                </div>\n            </div>\n            <div class="section-col">\n                <div>\n                    <label for="apmt-value-date">Date</label>\n                    <input id="apmt-value-date" class="apmt-field" disabled/>\n                </div>\n                <div>\n                    <label for="apmt-value-time">Time</label>\n                    <input id="apmt-value-time" class="apmt-field" disabled/>\n                </div>\n            </div>\n        </div>'}function m(){for(_=[],i=0;i<w;i++){let e=new Date(`${$("#date-selector").val()}T00:00:00`);e.setHours(0,0,0,0),e.setDate(e.getDate()+i),_.push(getFormattedDate(e,!0))}_=[...new Set(_)]}function p(){return'<div id="modal">\n            <div id="modal-loading" class="modal-body">\n                <div class="modal-title">LOADING</div>\n                <div class="modal-content">\n                    <div class="lds-ring">\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                    </div>\n                </div>\n            </div>\n        </div>'}function v(){return'<div class="f-modal-alert">\n            <div id="f-modal-error" class="f-modal-icon f-modal-error animate" style="display:none">\n                <span class="f-modal-x-mark">\n                    <span class="f-modal-line f-modal-left animateXLeft"></span>\n                    <span class="f-modal-line f-modal-right animateXRight"></span>\n                </span>\n                <div class="f-modal-placeholder"></div>\n                <div class="f-modal-fix"></div>\n            </div>\n            <div id="f-modal-warning" class="f-modal-icon f-modal-warning scaleWarning" style="display:none">\n                <span class="f-modal-body pulseWarningIns"></span>\n                <span class="f-modal-dot pulseWarningIns"></span>\n            </div>\n            <div id="f-modal-success" class="f-modal-icon f-modal-success animate" style="display:none">\n                <span class="f-modal-line f-modal-tip animateSuccessTip"></span>\n                <span class="f-modal-line f-modal-long animateSuccessLong"></span>\n                <div class="f-modal-placeholder"></div>\n                <div class="f-modal-fix"></div>\n            </div>\n            <div id="f-modal-message"></div>\n            <div>\n                <button id="f-modal-close" class="f-modal-button">Close</div>\n            </div>\n        </div>'}function f(){return'<div>\n            <label for="date-selector">Start Date</label>\n            <input id="date-selector" type="date" class="apmt-field" />\n        </div>'}function g(e="Dr. John Doe",t="BSc., MBBS",n="General Medicine",a=0,l=0,i=[],o=[],s=!1){let d=h(e,t,n,a,l),c=D(i,o,s);return`<div class="card">\n            ${d}\n            ${c}\n        </div>`}function b(e=0){return`<div class="selection-section-sml">\n            <div class="col">\n                <label for="apmt-date-selector-${e}">Appointment Date</label>\n                <input id="apmt-date-selector-${e}" type="date" class="apmt-field"/>\n            </div>\n            <div class="col">\n                <label for="apmt-time-selector-${e}">Appointment Time</label>\n                <select id="apmt-time-selector-${e}" class="apmt-field mobile-apmt-picker">\n                    <option value ="" hidden disabled selected> - Select a Time - </option>\n                </select>\n            </div>\n            <div>\n                <button id="apmt-select-submit-${e}" class="bttn bttn-sml">Next</button>\n            </div>\n        </div>`}function h(e="Dr. John Doe",t="BSc., MBBS",n="General Medicine",a=0,l=0){return`<div class="card-left">\n            <div class="details-section">\n                <div id="doctor-${l}-name" class="doctor-name">${e}</div>\n                <div id="doctor-${l}-cred" class="doctor-info">${t}</div>\n                <div id="doctor-${l}-spec" class="doctor-details">${n}</div>\n                <div id="doctor-${l}-cost" class="doctor-details">${formatCurrency(a)}</div>\n                </br>\n                <div class="select-indicator">Select an available time â†’</div>\n            </div>\n            ${b(l)}\n        </div>`}function D(e=[],t=[],n=!1){let a=`<div class="date-tabs">\n            ${e.map(e=>`<div class="date-tab">${e.label}</div>`).join("")}\n        </div>`,l=`<div class="schedule-overflow">\n            ${e.map(e=>{let n=t.filter(t=>t.APMNT_DT.substring(0,10)===e.value.toISOString().substring(0,10));return 0===n.length?'<div class="col"> <button class="slot">None</button> </div>':`<div class="col">\n                    ${n.map(e=>`<button class="slot" ref="${e.DOC_ID}" value="${e.SLOTS_ID}" date="${e.APMNT_DT}" time="${e.DISPLAY_TIME}">${getFormattedTime(e.DISPLAY_TIME)}</button>`).join("")}\n                </div>`}).join("")}\n        </div>`;return`<div class="card-right"> ${n?a:""} ${l} </div>`}function E(){let t="",n=0,a=!0;for(const e in A)if(A.hasOwnProperty(e)){let l=O.find(function(t){return t.DOC_ID==e});t+=g(l.DOCTOR_NAME,l.DEGREES_FMT,l.SPECILIZATION,l.CONS_FEE,n,_,A[e],a),a=!1,n++}$("#main").html(t),n=0;for(const e in A)d(`apmt-date-selector-${n}`,`apmt-time-selector-${n}`,e),n++;s(),c(),e()}function I(){for(const e in A){let t=[];A[e].forEach(e=>t=t.concat(e)),A[e]=t}E()}function S(){let e=0;O.forEach(n=>{let a=_.map(e=>postData("getSlots",{docId:`${n.DOC_ID}`,aptDate:`${getFormattedDate(e.value,!1).label}`}));Promise.all(a).then(t=>{A[`${n.DOC_ID}`]=t,e++,e===O.length&&I()}).catch(e=>{t("Something went wrong when updating the schedule. Please try again later."),console.error(`An error with the requests: ${e}`)})})}function T(){O.push({DOC_ID:223,DOCTOR_NAME:"John A Doe",DEGREES_FMT:"MDCM, FACS, FAANS (Physcian)",SPECILIZATION:"General Practicioner",EXPERIENCE:null,PRACTICE_NAME:"Pure Jamaica Medical Centre",SPECIALIZATION_ID:"00,00",SPECIALITY_ID:0,LOCATION_ADDR:"1 Stanton Terrace,  The Stantons , Kingston 6 , New Kingston",REG_FEE:50,CONS_FEE:5e3})}function C(){e();new Date(`${$("#date-selector").val()}T00:00:00`);m(),null==O||0==O.length?postData("getAllDoctors").then(e=>{O=e,T(),scheduleCounter=O.length*w,progressCounter=0,S()}).catch(e=>{t("Something went wrong during setup. Please try again later."),console.error(`Something went wrong with your request. ${e}`)}):(A={},progressCounter=0,u,S())}let O=[],A={},w=6,_=[],N=!1;$("#control-panel").html(p()+r()+f()),$("#custom-modals").html(v()),$("#f-modal-close").click(()=>n()),l(),C()});